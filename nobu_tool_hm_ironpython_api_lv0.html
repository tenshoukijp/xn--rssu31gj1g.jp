%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>hmPyの基礎中の基礎のAPI</h2>

<ul class="checklist">
    <li>
        <h3>概要</h3>
        <p>秀丸マクロから呼び出すhmPyの関数(API)は多くありません。</p>
        <p>
            ほとんどの場合は、「DoString」だけを使うこととなるでしょう。<br>
        </p>
        <p>Pythonファイルを別ファイルにした場合には、「DoFile」を使うことになるハズです。</p>
    <li>
        <ul class="pointlist">
            <li>
                <h4>
                    命令の実行:<br>
                    &nbsp;└ DoString(szexpression)
                </h4>
                <p>
                    <span class="positive">文字列「szexpression」をIronPythonの命令として実行します。</span><br>
                </p>
                <p>
                    何らかの明確な内部エラーがあった場合は0が、とりあえず実行できた場合は1が返ってきます。 <br>
                </p>
                <ul class="arrowlist">
                    <li>
                        <h5>１つのマクロ内で「DoString」は複数回実行可能、変数空間も同じ</h5>
                        <div class="code">
                            <pre class="brush:python">
#PY = loaddll( hidemarudir + @&quot;\hmPy.dll&quot; );

#_ = dllfuncw( #PY, &quot;DoString&quot;, R&quot;PY(

aaa = &quot;あいうお&quot;;

def mysum(a, b):
  return a + b

)PY&quot;
);


#bbb = 123;

#_ = dllfuncw( #PY, &quot;DoString&quot;, R&quot;PY(

bbb = hm.Macro.Var['#bbb']
ccc = aaa + &quot;続いている&quot; # 別のDoStringでも、aaa は引き続き利用できる。

hm.Macro.Var['$ddd'] = ccc;

hm.debuginfo( mysum(1,2) ); # 別のDoStringで定義した関数も当然利用できる。

)PY&quot;
);

message($ddd);

freedll( #PY );
</pre>
                        </div>
                </ul>
                <p>
                    <br>
                    <br>
                </p>
            <li>
                <h4>
                    命令の実行:<br>
                    &nbsp;└ DoFile(filename)
                </h4>
                <p>
                    <span class="positive">ファイル名「filename」内の記述内容全体をDoString(...)の引数に渡したものとして実行します。</span><br>
                </p>
                <p>
                    何らかの明確な内部エラーがあった場合は0が、とりあえず実行できた場合は1が返ってきます。 <br>
                </p>
                <ul class="arrowlist">
                    <li>
                        <h5>１つのマクロ内で「DoFile」は複数回実行可能、変数空間も同じ</h5>
                        <p>
                            繰り返しになりますが、DoFileとは、「該当のファイルの中身をそのままDoStringに渡す」ということですので、<br>
                            複数子のファイルを利用することが可能です。<br>
                            この際は、<span class="negative">変数名の衝突などに注意してください。</span>
                        </p>
                </ul>
                <p>
                    <br>
                    <br>
                </p>
            <li>
                <h4>
                    .pyファイルの文字コードの変更など:<br>
                    &nbsp;└ SetCodePage(codepage)
                </h4>
                <p>
                    「.py」ファイルは、「cp932(≒sjis)」「utf8(BOM有)」「utf16(BOM有)」のいずれかが想定されています。<br>
                    それ以外で取り扱いたい場合、「SetCodePage」関数を利用してください。<br>
                    この関数は「読み込み対象のファイル」が、該当のコードで記述してある、 という指定となります。
                </p>
                <ul class="arrowlist">
                    <li>
                        <h5>秀丸マクロ側の記述</h5>
                        <p>
                            例えば、以下のようにすることで、
                            <ul>
                                <li>読み込み対象の.pyファイルはutf8で記述してあるということになります。
                                <li>932:ShiftJIS(=cp932), 1200(utf16), 65001(utf8)となります。
                            </ul>
                        <p>基本的にまともに取り扱うことが出来る文字コードには、必ず「コードページ」が割り振られているため、あらゆるものに対応できます。</p>
                        <div class="code">
                            <pre class="brush:python">
#PY = loaddll( hidemarudir + @&quot;\hmPy.dll&quot; );

// 読み込み対象のファイルである「.pyファイル」は指定のコードページで書かれてます(65001=UTF8)ですよ、という指定
#_ = dllfuncw(#PY, &quot;SetCodePage&quot;, 65001 );

#_ = dllfuncw(#PY, &quot;DoFile&quot;, currentmacrodirectory + @&quot;\test.py&quot; );

freedll(#PY);
</pre>
                        </div>
                    <li>
                        <h5>IronPython側の記述</h5>
                        <fieldset class="code"><legend>test.py</legend>
                            <pre class="brush:python">
hm.debuginfo("テストテスト");
</pre>
                        </fieldset>
                </ul>
        </ul>
        </p>
</ul>

