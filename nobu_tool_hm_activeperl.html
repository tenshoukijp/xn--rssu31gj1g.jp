%(hilight)s
<h2><i class="fa fa-perl fa-fw"></i>hmPerl 秀丸マクロ用 スクリプト via ActivePerl</h2>


<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>秀丸マクロで「<span class="positive">ActiverPerlの機能を秀丸マクロとしてシームレスに近い形で利用する</span>」ためのライブラリとなります。</p>
    <p><b>ActivePerlの記述をベースとしつつ、秀丸マクロとの値のやりとりや、ActivePerlの中で秀丸マクロを実行</b>することも簡単になっています。</p>
    <li>
    <h3>ダウンロード</h3>
    <dl>
        <dt>
        <div class="download_file"><img src="./other_soft/hm_activeperl/cnt_hm_activeperl_minizip.png" attr="noedge" align="middle"> ⇒ <a href="%(file)s">hmPerl.zip</a>ファイル。ver 1.201</div>
        </dt>
        <dd>
        <div class="update_time">└更新日 %(year)04d/%(mon)02d/%(mday)02d</div>
        </dd>
    </dl>
    <li>
    <h3>動作環境</h3>
    <ul class="pointlist">
        <li>
        <h4>秀丸</h4>
        <p>秀丸エディタ x86版(32bit版) ver8.66以上</p>
        <li>
        <h4>ActivePerl x86版(32bit版)</h4>
        <p>ActivePerl <b>ver 5.10 ～ ver 5.24</b> まで。<br>
        <span class="negative">このバージョンの範囲のみ動作します。</span><br>
        <li>
        <h4>古いActivePerlの場所</h4>
        <p><a href="https://xray-engine.org/index.php?title=ActivePerl">https://xray-engine.org/index.php?title=ActivePerl</a></p>
        <li>
        <h4>PATH</h4>
        <p>ActivePerlは、「インストーラー」によってインストールしていること。<br>
        別のマシンからやzipなどを、手コピで持って来ただけ、などではないこと。<br>
        Perlにパス等が通っていること。</p>
    </ul>
    <li>
    <h3>意義と目的 → 秀丸エディタ v8.66の追加APIの総括サンプル</h3>
    <ul class="pointlist">
        <li>
        <h4>秀丸エディタ v8.66で追加されたプログラム機能</h4>
        <p>秀丸エディタ v8.66によって、<br>
        これまでの<b>「秀丸マクロ」と「秀丸マクロから利用するC言語などで作ったライブラリ」との関係に、<br>
        大きく影響のある機能が多数追加</b>されました。<br>
        (当サイトの管理人がそのような機能を中心に、集中的に要望し、サイトー企画さんに実装してもらったと言えます)</p>
        <p>しかし、これらの追加された機能の１つ１つをバラバラに眺めているだけでは、何が可能になったのか体感しにくいものです。<br>
        </p>
        <li>
        <h4>追加された機能の全体としての狙いを見る</h4>
        <p>実際に「全体をトータルに組み合わせた実装例」を「動くコンポーネント」と提供して「ソース付」で提供することで、<br>
        「何が可能となったのか全体像を理解しやすくするサンプル」としての目的が大部分です。</p>
        <li>
        <h4>実際の使用にも耐えるdllコンポーネント</h4>
        <p>比較的レガシーな資産や、グルーな環境において、ActivePerlはまだまだ現役です。<br>
        「手に馴染んだスクリプト環境はActivePerl」だ、といった人も多く、<br>
        「秀丸マクロの処理の大部分をActivePerlで書けるコンポーネントの提供」は、<br>
        ひとつの新たな可能性をもたらすことでしょう。<br>
        </p>
    </ul>
    <li>
    <h3>インストール</h3>
    <ul>
        <li>hmPerl.zipを解凍する。
        <li><span class="positive">「hmPerl.dll」と「hmPerl.pm」を秀丸エディタのディレクトリ内(hidemaru.exeと同じ場所)へと コピー</span>する。<br>
    </ul>

    <h3>ソース例</h3>
    <ul>
        <li>(DoString関数の中身の記述は)ActivePerlで動作するソースは原則的には動作します。<br>
        <li>Perl内から秀丸マクロが実行可能です。
        <li>Perlと秀丸マクロとの変数のやり取りも、Perlで記述します。
        <li>秀丸マクロとPerlで値をやりとりする以上、グローバル変数が比較的頻繁に出現しますので、<br>
        「use strict」などは無理のあるオプションとなります。
    </ul>
    <ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(
use Win32;
use Encode;

# 現在秀丸編集中のテキスト内容。テキストの取得だけではなく、テキストの設定も可能。
my $text = hm-&gt;Edit-&gt;TotalText();

if (&quot;表示&quot; =~ /表/) {
  hm-&gt;debuginfo(&quot;表示という文字列がマッチ&quot;)
}

my $a = hm-&gt;Edit-&gt;CursorPos-&gt;{lineno};
hm-&gt;debuginfo(&quot;現在のカーソルのlineno:&quot;.$a);
my $b = hm-&gt;Edit-&gt;CursorPos-&gt;{column};

for (1..10) {
    hm-&gt;debuginfo(&quot;現座のカーソルのcolumn:&quot;.$b);
}

# 秀丸マクロの「filename」のシンボルの内容をこのPerlに持ってくる
my $filename = hm-&gt;Macro-&gt;Var('filename');
hm-&gt;debuginfo($filename);

my $title = '質問';
my $decoded_title = Encode::decode('utf-8', $title);
my $decoded_text = Encode::decode('utf-8', $text);

$reply = Win32::MsgBox($decoded_text, 4, $decoded_title);

hm-&gt;Macro-&gt;Var('$bbbbb', &quot;Perlから秀丸マクロへと出す&quot;);
hm-&gt;Macro-&gt;Var('$ccccc', &quot;Perlの外の秀丸マクロ空間へ&quot;);

hm-&gt;Macro-&gt;Eval(&lt;&lt;'MACRO'
    message($bbbbb); // Perlの中で秀丸マクロを実行する。
MACRO
);
)PERL&quot;);

message($ccccc); // 秀丸マクロへと伝達されたものは、Perlの外からも見える

freedll( #Perl );
</pre></div>
    </ul>
    <h3>ライセンス</h3>
    <ul class="pointlist">
        <li>
        <h4>hmPerl.dll、hmPerl.dllのソース、hmPerl.pmのソース</h4>
        <p>全て Apache License 2.0となります。<br>
        </p>
        <h4>ソースの場所</h4>
        <ul>
            <li><a href="https://github.com/vscode-life/hidemaru-net/tree/master/win-hidemaru-app/hm_activeperl">Github</a>にソースがあります。<br>
            <li>コンパイルするのにActivePerlの「***perl\lib\CORE\PerlEz.h」を参照するので、<br>インクルードパスとして「***perl\lib\CORE」を追加してください。
        </ul>
    </ul>
</ul>