%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>外部アプリケーションから秀丸のアウトプット枠への出力<br>
(各言語での簡易な呼び出し例)</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p><span class="positive">HmSharedOutputPane.dllを利用した、各言語による呼び出しの基本例です。</span><br>
    <br>
    <span class="negative">もしもあなたが「特別に」「64bit版の秀丸」をインストールしているのであれば、<br>
    「HmSharedOutputPane.dll」を呼び出すプログラムも64bit版である必要性があります。</span></p>
    <p><img src="./other_soft/hm_sharedoutputpane/cnt_hm_sharedoutputpane_03.png"></p>
    <li>
    <h3>C#</h3>
    <p>コンソールアプリケーションにしろ、フォームアプリケーションにしろ、<br>
    総合的にはC#が一番簡単に利用できるでしょう。</p>
    <p>C#であれば、デフォルト設定の「ANY CPU」でコンパイルしておけば、<br>
    秀丸32bit版か秀丸64bit版かを問わないプログラムとなるでしょう。<br>
    「ANY CPU」ではうまくいかない場合には、「x86」として明示的にビルドするなどしてください。</p>
    <div class="code"><pre class="brush:csharp">
using System;
using System.Runtime.InteropServices;


class Program
{
    [DllImport(@&quot;C:\usr\hidemaru\hmSharedOutputPane.dll&quot;)]
    private extern static void SetSharedMessage(String msg);

    static void Main(string[] args)
    {
        for ( int i=0; i&lt;100; i++)
        {
            SetSharedMessage(&quot;モジモジ文字列&quot; + i.ToString());
        }
    }
}
</pre></div>

    <li>
    <h3>C++</h3>
    <p>今回の例では、「文字セットをマルチバイト」として指定したものとします。</p>
    <p><img src="./other_soft/hm_sharedoutputpane/cnt_hm_sharedoutputpane_04.png"></p>
    <div class="code"><pre class="brush:cpp">
#include &lt;windows.h&gt;
#include &lt;string&gt;

using namespace std;

// 秀丸のディレクトリの指定。この場合は、「C:\usr\hidemaru\hidemaru.exe」という位置関係にある。
const string strDLLFullPath = R&quot;(C:\usr\hidemaru\HmSharedOutputPane.dll)&quot;;

using PFNSETSHAREDMESSAGE = void(_stdcall *)(const char *szmsg);

HMODULE dll = NULL;
void main(void) {
  dll = LoadLibrary(strDLLFullPath.data());
  if (dll) {
    PFNSETSHAREDMESSAGE hmOutPut = (PFNSETSHAREDMESSAGE)GetProcAddress(dll, &quot;SetSharedMessage&quot;);
    for(int i=0; i&lt;100; i++) {
      string msg = &quot;モジモジ文字列&quot; + to_string(i);
      hmOutPut(msg.data());
    }
  }
}
</pre></div>
    <li>
    <h3>ActivePython</h3>
    <p>ソースの手軽さとわかりやすさ、という点において、ActivePythonは群を抜いているでしょう。<br>
    SHIFT_JIS(cp932)でPythonのソースを保存してください。</p>
    <div class="code"><pre class="brush:python">
#coding: cp932

from ctypes import *
dll = windll.LoadLibrary('C:\\usr\\hidemaru\\HmSharedOutputPane.dll')
[ dll.SetSharedMessage( 'モジモジ文字列'+str(i) ) for i in range(0, 100) ]
</pre></div>
    <li>
    <h3>hmLJ</h3>
    <p>SHIFT_JIS(cp932)でLuaのソースを保存してください。</p>
    <div class="code"><pre class="brush:lua">
ffi.cdef[[
void SetSharedMessage(char *msg)
]]

hmSharedOutputPane = ffi.load('C:\\usr\\hidemaru\\HmSharedOutputPane.dll')

for i=0, 99 do
    luaString = &quot;モジモジ文字列&quot; .. tostring(i)
    szMsgBuf = ffi.new('char[?]', 1024,  luaString )
    hmSharedOutputPane.SetSharedMessage( szMsgBuf )
end
</pre></div>
    <li>
    <h3>Ruby</h3>
    <p>今回の例では、SHIFT_JIS(cp932)でRubyのソースを保存したものとします。</p>
    <div class="code"><pre class="brush:ruby">
#coding: cp932

require 'fiddle/import'
require 'fiddle/types'

module WinAPI
    extend Fiddle::Importer
    dlload 'C:\usr\hidemaru\HmSharedOutputPane.dll'
    include Fiddle::BasicTypes
    include Fiddle::Win32Types

    extern &quot;void SetSharedMessage(const char*)&quot;
end

0.upto(99) { |i|
    WinAPI::SetSharedMessage(&quot;モジモジ文字列&quot; + i.to_s())
}

</pre></div>
</ul>