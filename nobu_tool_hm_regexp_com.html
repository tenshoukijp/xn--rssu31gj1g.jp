%(hilight)s
<h2><i class="fa fa-gears fa-fw"></i>秀丸エディタ・マクロ用 正規表現関数 COM版</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>秀丸の<span class="positive">マクロ内から、手軽に正規表現を利用するためのライブラリ</span>です。<br>
    <span class="positive">loaddllを使っていないため</span>
    <ul>
        <li>取り回しがしやすい
        <li>複雑なマクロとくっ付け易い
    </ul>
    <p>等といった利点があります。<br></p>
    <p>正規表現を利用する人に欠かせない２つの関数だけを実装しました。<br></p>
    <ul class="pointlist">
        <li>
        <h4>BOOL HMRE_Match(&quot;対象文字列&quot;, &quot;部分マッチ正規表現&quot;, &quot;オプション&quot;);</h4>
        正規表現を使ったマッチ成否の結果をえる関数(括弧部分の文字列の抽出も兼ねる)
        <li>
        <h4>string HMRE_Replace(&quot;対象文字列&quot;, &quot;部分マッチ正規表現&quot;, &quot;置き換え後文字列&quot;, &quot;オプション&quot;);</h4>
        正規表現を使った文字列置き換え関数 です。<br>
    </ul>
    <p>この２つさえあれば、通常の正規表現対策としては十分でしょう。<br></p>
    </h4>

    <h3>使いどころ</h3>
    <p>loaddllを使うタイプでは、マクロ実行中に秀丸ウィンドウが切り替わると、再度loaddllが必要になるなど、<br>
    細かなバグが入り込む余地が多く、気を使うデリケートな扱いを要求されるシーンもあります。<br>
    <span class="negative">しかし、このライブラリは、そのような心配とは無縁です。<br>
    関数の実装をコピペして、使えばＯＫです。</span></p>

    </span>
    <li>
    <h3>ダウンロード</h3>
    <dl>
        <dt>
        <div class="download_file">DOWNLOAD ⇒ <a href="%(file)s">HmRegexpCom.zip</a>ファイル。ver 1.00</div>
        </dt>
        <dd>
        <div class="update_time">└更新日 %(year)04d/%(mon)02d/%(mday)02d</div>
        </dd>
    </dl>
    <h3>動作環境</h3>
    <ul>
        <li>秀丸 ver8.00以上。
    </ul>
    <h3>使い方のソース例</h3>
    <div class="code"><pre class="brush:hmmacro">
/*
■マッチ成否と「( )キャプチャ」の捕捉の例。
  主要なプログラミング言語の正規表現の記述に慣れている人であれば、感覚に近い記述のハズ。
  「\が付くメタ文字」をエスケープするのを忘れないこと
*/
call HMRE_Match &quot;ccあいうaaa333&quot;, &quot;(あ)(.+?)\\b([a-z]+)(\\d+)$&quot;;
#ret = ##return; // 数値タイプで返ってくる
if (#ret) {
  message(&quot;マッチした&quot;);
} else {
  message(&quot;マッチせず&quot;);
}

// マッチのキャプチャ(括弧で囲んだマッチ部分)結果は「$HMRE_M」という名称の文字列配列に入る。
message($HMRE_M[0]); // → あいうaaa333
message($HMRE_M[1]); // → あ
message($HMRE_M[2]); // → いう
message($HMRE_M[3]); // → aaa
message($HMRE_M[4]); // → 333

/*
■置き換えの例
  後方参照などの$1$2などが使えるので、サクッと変形できるだろう。
  iオプションにより、大文字小文字を無視出来る。
*/
call HMRE_Replace &quot;AAABBBCCC&quot;, &quot;(\\w{3})(.+?)(c+)&quot;, &quot;頭$3$2$1尻&quot;, &quot;i&quot;;
$ret = $$return; // 文字列タイプで返ってくる
message($ret); // → 頭CCCBBBAAA尻


endmacro;

</pre></div>

    <h3>コピペで使えるライブラリ</h3>
    <p>上述のzipファイルをダウンロードして利用する代わりに、<br>
    下記ソースを<span class="positive">ご自身のマクロの下部にペーストしておく</span>ことでも関数を利用することができます。</p>
    <div class="code"><pre class="brush:hmmacro">
endmacro;
HMRE_Match:
$$str_source = $$1; $$str_regexp = $$2; $$str_option = $$3; call HMRE_Clear_M; ##rgx_obj = createobject(&quot;VBScript.RegExp&quot;); setpropstr ##rgx_obj, &quot;Pattern&quot;, $$str_regexp; if (strstr($$str_option, &quot;i&quot;) &gt;= 0) { setpropnum ##rgx_obj, &quot;IgnoreCase&quot;, 1; } else { setpropnum ##rgx_obj, &quot;IgnoreCase&quot;, 0; } ##matchs_obj_list = member(##rgx_obj, &quot;Execute&quot;, $$str_source); ##COM_LAST_HRESULT = 11; ##error_result = getresultex(##COM_LAST_HRESULT); if (##error_result != 0) { message(&quot;正規表現エラー:&quot; + $$str_regexp); } ##matchs_cnt = member(##matchs_obj_list, &quot;Count&quot;); if (##matchs_cnt == 0) { releaseobject(##rgx_obj); return 0; } ##COLLECTION_OBJECT_REQUEST_NEXT = 0; ##COLLECTION_OBJECT_RELEASE_COMMAND = 3; ##match_obj = 0; while(1) { ##match_obj = getcollection(##matchs_obj_list, ##COLLECTION_OBJECT_REQUEST_NEXT); if ( ##match_obj == 0 ) { break; } ##sub_matches = member(##match_obj, &quot;SubMatches&quot;); ##sub_matches_cnt = member(##sub_matches, &quot;Count&quot;); ##sub_matches_ix = 0; while(##sub_matches_ix &lt; ##sub_matches_cnt) { $$str_sub_match = member(##match_obj, &quot;SubMatches&quot;, ##sub_matches_ix); $HMRE_M[##sub_matches_ix+1] = $$str_sub_match; ##sub_matches_ix = ##sub_matches_ix + 1; } #HMRE_M_ArrayLength = ##sub_matches_cnt + 1; $$match_value = member(##match_obj, &quot;Value&quot;); $HMRE_M[0] = $$match_value; } ##match_obj = getcollection( #matchs_obj_list, ##COLLECTION_OBJECT_RELEASE_COMMAND ); releaseobject(##rgx_obj); return 1;
HMRE_Replace:
$$str_source = $$1; $$str_regexp = $$2; $$str_replace = $$3; $$str_option = $$4; call HMRE_Clear_M; ##rgx_obj = createobject(&quot;VBScript.RegExp&quot;); setpropstr ##rgx_obj, &quot;Pattern&quot;, $$str_regexp; if (strstr($$str_option, &quot;i&quot;) &gt;= 0) { setpropnum ##rgx_obj, &quot;IgnoreCase&quot;, 1; } else { setpropnum ##rgx_obj, &quot;IgnoreCase&quot;, 0; } $$str_result = member(##rgx_obj, &quot;Replace&quot;, $$str_source, $$str_replace); ##COM_LAST_HRESULT = 11; ##error_result = getresultex(##COM_LAST_HRESULT); if (##error_result != 0) { message(&quot;正規表現エラー:&quot; + $$str_regexp); } releaseobject(##rgx_obj); return $$str_result;
HMRE_Clear_M:
##array_cnt = #HMRE_M_ArrayLength; ##ix = 0; while(##ix &lt; ##array_cnt) { $HMRE_M[##ix] = &quot;&quot;; ##ix = ##ix + 1; } #HMRE_M_ArrayLength = 0; return;
</pre></div>
    <h3>ライセンス</h3>
    <p>MITライセンスです。</p>
    <h3>その他、備考など</h3>
    <p>秀丸のHMJRE.dllをloaddllしてマクロ内で正規表現を利用する方法は、<a href="http://hidemaruo.mydns.jp:81/helpsite/hmjre/html/0008_API_MACRO.html">こちら</a>に掲載されています。</p>
</ul>