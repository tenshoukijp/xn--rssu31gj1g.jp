%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>Unicode(utf16)を取り扱う</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>秀丸エディタのデータや、外部データがutf16の範囲の文字列であっても、<br>
    秀丸マクロやIronPythonは問題なく取り扱うことが出来ますが、<br>
    <b>「秀丸マクロ内」及び「IronPython」内に、cp932(sjis)の範囲を超える文字を直接記述する際には、</b><br>
    <b>「秀丸マクロ」や「hmPy」を「utf16のモード」で、動作させる</b>のが良いでしょう。</p>
    <li>
    <h3>UTF16のマクロファイル</h3>
    <p><span class="negative">これまで秀丸マクロをcp932(ShiftJIS)にて保存してきましたが、<br>
    Unicodeを取り扱う際には、秀丸マクロをUnicodeで保存</span>します。<br>
    <b>秀丸マクロは通常「cp932(sjis)」ですが、このようにUnicodeの文字列を直接取り扱えるよう「unicode(utf16)」でも動作するようになっています。</b><br>
    </p>
    <p><img src="./other_soft/hm_ironpython/cnt_hm_ironpython_unicode_01.png"></p>
    <ul>
        <div class="code"><pre class="brush:python;highlight:[3]">
#dll = loaddll( hidemarudir + @&quot;\hmPy.dll&quot; );

#r = dllfuncw( #dll, &quot;SetCodePage&quot;, 1200 ); // utf-16

#r = dllfuncw( #dll, &quot;SetStrVar&quot;, &quot;currentmacrodirectory&quot;, currentmacrodirectory );

#r = dllfuncw( #dll, &quot;DoString&quot;, R&quot;IRONPYTHON(
import clr
result = &quot;あああ♬♬♬♬♬あああ&quot;
)IRONPYTHON&quot;
);

$result = dllfuncstrw( #dll, &quot;GetStrVar&quot;, &quot;result&quot; );
message($result);

#_ = dllfuncw( #dll, &quot;DestroyScope&quot; );
freedll(#dll);
</pre></div>
    </ul>
    <p>cp932での記載との違いは以下の３つとなります。</p>
    <ul class="pointlist">
        <li>
        <h4>マクロの保存文字コード</h4>
        <p>マクロそのものを「Unicode(utf-16)」でBOM付きで保存すること</p>
        <li>
        <h4>文字コードの明示的な指定</h4>
        <p>#r = dllfuncw( #dll, &quot;SetCodePage&quot;, 1200 ); // utf-16</p>
        <p>と、IronPythonがutf-16と解釈すべきことを明示します。</p>
    </ul>
    <li>
    <h3>.pyファイルを外部に出す場合には、utf-16のcoding指定</h3>
    <p>「DoFile」を使うなど、.pyファイルを外部に出す際は、マクロをcp932で保存していた際には「#coding:cp932」を指定していましたが、<br>
    <b>マクロをUnicodeで保存する際には.py側は「coding:utf-16」を指定する</b>必要があります。</p>
    <p>例えば、以下のような「myunicode.py」を用意し、Unicode(utf16)で保存します。</p>
    <ul>
        <div class="code"><pre class="brush:python;highlight:[1]">
#coding: utf-16

import clr
result = &quot;あああ♬♬♬♬♬あああ&quot;
</pre></div>
    </ul>
    <p>マクロ側で以下のように呼び出す形となります。<br>
    <b>マクロもUnicode(utf16)で保存するのを忘れないように</b>してください。</p>
    <ul>
        <div class="code"><pre class="brush:python">
#dll = loaddll( hidemarudir + @&quot;\hmPy.dll&quot; );

#r = dllfuncw( #dll, &quot;SetCodePage&quot;, 1200 );

#r = dllfuncw( #dll, &quot;SetStrVar&quot;, &quot;currentmacrodirectory&quot;, currentmacrodirectory );

#r = dllfuncw( #dll, &quot;DoFile&quot;, &quot;myunicode.py&quot; );

$result = dllfuncstrw( #dll, &quot;GetStrVar&quot;, &quot;result&quot; );
message($result);

#_ = dllfuncw( #dll, &quot;DestroyScope&quot; );
freedll(#dll);
</pre></div>
    </ul>

</ul>

