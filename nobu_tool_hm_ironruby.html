%(hilight)s
<h2><i class="fa fa-ruby fa-fw"></i>hmRb (秀丸マクロ用 .NET Framework ライブラリ via IronRuby)</h2>

<ul class="checklist">
    <li>
    <p>秀丸マクロで「<span class="positive">.NET Frameworkの多くの機能をシームレスに近い形で利用する</span>」ためのライブラリとなります。</p>
    <li>
    <h3>秀丸マクロとIronRubyの連携</h3>
    <ul class="pointlist">
        <li>HTMLにJavaScriptを埋め込むような感覚で、秀丸マクロにIronRubyを文字列として埋め込むことが出来ます。<br>
        複数個所に埋め込んでも、記述の内容は持続性を持っています。<br>
        又、HTMLに対するJavaScript同様に、中に埋め込むのではなく、ファイルの外に記述してもかまいません。<br>
    </ul>

    <h3>ダウンロード</h3>
    <dl>
        <dt>
        <div class="download_file"><img src="./other_soft/hm_ironruby/cnt_hm_ironruby_minizip.png" attr="noedge" align="middle"> ⇒ <a href="%(file)s">hmRb.zip</a>ファイル。ver 1.481</div>
        </dt>
        <dd>
        <div class="update_time">└更新日 %(year)04d/%(mon)02d/%(mday)02d</div>
        </dd>
    </dl>
    <li>
    <h3>動作環境</h3>
    <ul class="pointlist">
        <li>
        <h4>秀丸</h4>
        <p>秀丸エディタ ver8.66以上</p>
        <li>
        <h4>Microsoft VC++ 再頒布可能パッケージ</h4>
        <p><a href="https://www.microsoft.com/ja-jp/download/details.aspx?id=40784">Visual Studio 2013 C++ ランタイム</a><br>
        x86版をインストールしたことが無い方はインストールしてください。<br>
        <span class="negative">お手持ちのOSが64bitか32bitかには関わりなく、x86版のインストールが必要です。</span></p>
        <li>
        <h4>Microsoft .NET</h4>
        <p>.NET Framework 4.0以上。<br>
        </p>
        <li>
        <h4>秀丸エディタ 64bit版について</h4>
        <p>秀丸エディタ64bit版をご利用の方は、<a href="/other_soft/hm_ironruby/hmRb_x64.zip">hmRb_x64.zip</a>をダウンロードし、hmRb.dllを差し替えてください。<br>
        (又、この場合は、Microsoft VC++ 再頒布可能パッケージは、64bit版をインストールしてください。)</p>
    </ul>
    <li>
    <h3>インストール</h3>
    <ul>
        <li>hmRb.zipを解凍する。
        <li><span class="negative">「hmRb.dll」と「IronRuby.Libraries.dll」を秀丸エディタのディレクトリ内(hidemaru.exeと同じ場所)へと コピー</span>する。<br>
        (<span class="negative">原則的には、hidemaru.exeと同じ場所である必要があります。これは.NET FrameWorkのdllを動作させる仕組みに拠るためです。)</span>
    </ul>
    <li>
    <h3>特徴</h3>
    <ul class="pointlist">
        <li>
        <h4>.NET Frameworkの多くの機能が利用可能。</h4>
        <fieldset class="alert"><legend>秀丸マクロから「.NET FrameWork」の「System.Windows.Formsコンポーネント系」を実行した例</legend><br>
        <img src="./other_soft/hm_ironpython/cnt_hm_ironpython_01.png" attr="noedge"></fieldset>
        <li>
        <h4>ユニークな言語「IronRuby」</h4>
        <p>プログラミング言語としては「Ruby」派生の１つとなる「IronRuby」となります。<br>
        「IronRuby」は、かつてMicrosoftによって「Visual Studio 2010」にて正式にサポートされた言語です。<br>
        (※但し、それ以降はサポートされていません。又、IronRubyプロジェクトは事実上停止しています。) <br>
        </p>
    </ul>
    <li>
    <h3>利用シーン</h3>
    <ul class="pointlist">
        <li>
        <h4>マクロ内で豊富な.NETのAPIの機能を利用したい!!</h4>
        <p>WindowsのAPIを綺麗に使いやすくした .NETを 秀丸マクロで取り扱うことが出来ます。<br>
        <ul>
            <li>文字列処理
            <li>ウィンドウズの各機能へのアクセス
            <li>各種GUIコンポーネントやイベントハンドラ
            <li>インターネット上のデータの取得
            <li>各種ファイル処理
            <li>並列スレッド
            <li>簡易な数学計算
        </ul>
        <p>に至るまで、.NET Frameworkにアクセス可能です。<br>
        </p>
        <li>
        <h4>秀丸エディタ 8.66 以降では、IronRubyをそのままマクロ内に記述出来る!!</h4>
        <p>秀丸エディタ 8.66にて、「ヒアドキュメント」が実装されたため、<br>
        IronRubyをそのままマクロ内に記述出来るようになりました。(エスケープ等の必要性がなくなりました!)<br>
        詳細は後述されています。</p>
        <li>
        <h4>Rubyから秀丸マクロの変数やシンボルにアクセス出来る!! 秀丸マクロも実行できる!!</h4>
        <p>この機能により、「秀丸マクロならでわの機能」と「IronRubyの性能」が融合し、飛躍的に実装の幅が広がりました。</p>
        <li>
        <h4>Rubyにある、あの正規表現が必要だ!! なければ生きていけない!!</h4>
        <p>あのPerl方式の正規表現があるだけでも利用価値があります。<br>
        <li>
        <h4>秀丸マクロの言語としてのパワーが弱い!! 圧倒的なグラマーが欲しい!!</h4>
        <p>Ruby 1.9.2とほぼ互換の文法となります。<br>
        Rubyとしては古くなってしまいましたが、組み込み言語としては十分に過ぎるほどの文法と言えるでしょう。
    </ul>
    <li>
    <h3>秀丸マクロの代替言語としては最もポテンシャルが高い</h3>
    <ul class="pointlist">
        <li>
        <h4>エディタのマクロで比較的使用頻度が高い正規表現が使いやすい</h4>
        <p>IronPythonには言語そのものには高度な正規表現がありませんが、IronRubyにはそれがあります。<br>
        エディタ向けのスクリプト言語としては、この点は評価ポイントが高いのです。</p>
        <li>
        <h4>NGenを利用すると、起動が非常に速い</h4>
        <p>IronRuby.Libraries.dllをNGenで登録することで、<br>
        実行時にひっかかりを体感できないほど速くなります。<br>
        </p>
        <li>
        <h4>IronPythonには及ばないが、.NETとの融合性がそこそこ高い</h4>
        <p>.NETのクラスをruby層で継承するなども可能です。</p>
        <li>
        <h4>C#などで独自に作った.dllが読み込みしやすい</h4>
        <p>元々用意されている.NETのクラスのみならず、<br>
        独自に自作したマネージドのファイルも非常に読み込みしやすくなっています。</p>
        <li>
        <h4>スクリプトを切り貼りしてインデントが崩れてもＯＫ</h4>
        <p>Pythonですと、切り貼りしているうちにインデントが崩れてエラーになってしまいますが、<br>
        Rubyではその心配がありません。</p>
        <li>
        <h4>２つのdllで動作する!!</h4>
        <p>hmPy同様、<span class="positive">hmRb.dllとIronRuby.Libraries.dllの２つのdllだけで動作</span>し、<br>
        他の独立したインタプリタは必要ありません。 又、秀丸マクロと同じプロセス空間で動作していますので、ガッチリ秀丸と完全連携します。<br>
        </p>
    </ul>
    <h3>ファイルの文字コード</h3>
    <p><span class="positive">hmRbは「秀丸マクロ」「.rbファイル」共に<br>
    「utf-8(BOM有)」もしくは「utf-16(BOM有)」で記述することを想定 </span> しています。<br>
    (.rbファイルに限っては「utf-8(BOM無)」にも対応しています。)</p>
    <li>
    <h3>「w付き」関数を利用のこと</h3>
    <p>「dllfuncではなく、必ず「dllfunc<b>w</b>」を、dllfuncstrではなく、「dllfuncstr<b>w</b>」を使ってください。</p>
    <li>
    <h3>一番簡単なソース例</h3>
    <p>「秀丸マクロ・マクロ変数」「Ruby」「.NET Framework」をまぜこぜに出来るため、非常に強力なパワーがあります。</p>
    <ul class="pointlist">
        <li>
        <h4>.NET FrameWorkを使って、ダイアログ表示</h4>
        <div class="code"><pre class="brush:ruby">
#RB = loaddll( hidemarudir + @&quot;\hmRb.dll&quot; );

$message = &quot;秀丸からのメッセージ&quot;;
$title = &quot;秀丸からのタイトル&quot;;

#_ = dllfuncw(#RB, &quot;DoString&quot;, R&quot;IRONRUBY(
require &quot;mscorlib&quot;
load_assembly &quot;System&quot;
load_assembly &quot;System.Windows.Forms&quot;

include System::Windows::Forms

if &quot;表示&quot; =~ /表/
    MessageBox.Show( $hm.Macro.Var['$message'], $hm.Macro.Var['$title'], MessageBoxButtons.YesNoCancel )
end
)IRONRUBY&quot;
);

freedll(#RB);
</pre></div>
        <p><img src="./other_soft/hm_ironpython/cnt_hm_ironpython_04.png"></p>
        <li>
        <h4>.NET FrameWorkを使って、秀丸とインタラクティブに機能するフォームの例</h4>
        <div class="code"><pre class="brush:ruby">
#RB = loaddll( hidemarudir + @&quot;\hmRb.dll&quot; );

#_ = dllfuncw(  #RB, &quot;DoString&quot;, R&quot;IRONRUBY(
require 'mscorlib'
load_assembly &quot;System.Windows.Forms&quot;
load_assembly &quot;System.Drawing&quot;

include System::Windows::Forms
include System::Drawing

$result_from_ruby = $hm.Macro.Var['date']; # 秀丸マクロの「date」シンボルの文字列

class IronRubyForm &lt; Form

  def initialize()
    self.Text = 'こんにちわ'
    self.Size = Size.new(400, 200)
    @btn = Button.new
    @btn.Location = Point.new(16, 16)
    @btn.Width = 200
    @btn.Text = &quot;クリック&quot;
    @btn.Click { |sender, e| self.btn_Click(sender, e) }

    @count = 0;

    self.Controls.Add(@btn)
  end

  def btn_Click(sender, e)
    @count += 1;
      $hm.Macro.Var['$count'] = @count.to_s
      MessageBox.Show( &quot;今開いているファイルは…\n&quot; + $hm.Macro.Var['filename2'] );

      $hm.Macro.Eval &lt;&lt;-'MACRO'
        // アウトプット枠へ出力
        #OP = loaddll(&quot;HmOutputPane.dll&quot;);
        #ret = dllfunc(#OP, &quot;Output&quot;,hidemaruhandle(0), $count);
        freedll(#OP);
      MACRO
  end

end


f = IronRubyForm.new
f.ShowDialog

)IRONRUBY&quot;
);

freedll( #RB );
        </pre></div>
    </ul>
    <li>
    <h3>注意点</h3>
    <ul class="pointlist">
        <li>「Rubyの標準ライブラリ」に相当するもののほとんどは、hmRb/IronRubyには標準では搭載していません。<br>
        そのほとんどのものは.NET Frameworkと機能がかぶるためです。.NET Frameworkライブラリを積極的に活用しましょう。<br>
        (<span class="negative">但し、<a href="http://ironruby.net/">IronRuby 1.1.3</a>を<b>「msiインストーラー」</b>でインストールしておけば、パス登録や必要な設定がされるため、<br>
        hmRbからでもIronRubyの標準ライブラリを自動的に使うことが出来ます</span>) <br>
    </ul>
    <li>
    <h3>IronRubyの採用は慎重に!!</h3>
    <p>いい点ばかりではありません。注意すべき点もあります。</p>
    <ul class="pointlist">
        <li>
        <h4>マイクロソフトのIDEでのサポートは無い</h4>
        <p>マイクロソフトによるサポートがずっと続いているIronPythonとは異なり、<br>
        IronRubyはVisual Studio 2010でデビューしたもの、その後組み入れは終了してしまいました。<br>
        又、IronRubyの更新は2012年以降停滞しているため、今後更新されないであろうことが予想されます<br>
        <li>
    </ul>

    <h3>Rubyとして捉えるのではなく秀丸マクロの代替言語として</h3>
    <p>Rubyとして捉えるのではなく、<br>
    <ul>
        <li>.NETのライブラリもほとんど全て利用可能で<br>
        (IronRubyが更新されなくとも、.NETの将来のバージョン、およびそれらを前提としたライブラリ群は利用可能です。<br>
        よって将来のライブラリの恩恵は受けることが出来ます)
        <li>秀丸マクロそのものが実行可能で
        <li>秀丸マクロの変数にも自由に読み取り・書き込みが可能で
        <li>Rubyにそっくりな強力な文法をもち、もう文法が変化することはない。
    </ul>
    <p>そんな「Rubyそっくりの秀丸マクロの代替強化言語」が提供された、と捉えるのがよいのではないでしょうか。</p>
    <li>
    <h3>ライセンス</h3>
    <ul class="pointlist">
        <li>
        <h4>hmRb</h4>
        <p>hmRbは、Apache License 2.0となります。<br>
        </p>
        <h4>ソースの場所</h4>
        <ul>
            <li><a href="https://github.com/vscode-life/hidemaru-net/tree/master/win-hidemaru-app/hm_ironruby">Github</a>にソースがあります。<br>
        </ul>
        <li>
        <h4>IronRuby</h4>
        <p>IronRubyについても、Apache License 2.0です。<br>
        詳細は、<a href="http://ironruby.net/">http://ironruby.net/</a>を見てください。</p>
    </ul>
</ul>