%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>hmLoadCLR内のLua(NeoLua)の独自の文法</h2>


<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>hmLoadCLR内部のスクリプトは、Luaとそっくりになっており、<br>
    Luaの文法のほとんど全てが実行可能です。<br>
    </p>
    <p>そういったものはLua言語のリファレンスマニュアル等を参照してください。</p>

    <p>ここでは、通常のLuaには存在しない、hmLoadCLR内部で利用されている「NeoLua」独特の文法のみ<br>
    ピックアップします。</p>
    <p>これら独自文法は、汎用性に欠けるため、利用は最低限に控えるようにしましょう。<br>
    可能な限り、C#などマネージdllの内部で処理を済ませるように心がけて下さい。</p>
    <p>大量のNeoLuaスクリプトが必要となるようなら、疑問を持ってください。<br>
    そのような場合は、hmPy/IronPythonの方がよりよい結果となるはずです。</p>

    <h3>foreach</h3>
    <div class="code"><pre class="brush:lua">
function text()
  return &quot;Hallo&quot;, &quot;Welt&quot;;
end;

function test(...)
  foreach c in ... do
    hm.debuginfo(c)
  end
end

foreach c in text() do
  hm.debuginfo(c)
end

</pre></div>

    <h3>cast</h3>
    <div class="code"><pre class="brush:lua">
local s = &quot;Hallo Welt&quot;;
local sb = clr.System.Text.StringBuilder();

sb:Append(cast(string, string.upper(s)));

hm.debuginfo(sb:ToString());
</pre></div>

    <h3>const</h3>
    <div class="code"><pre class="brush:lua">
const a = 3 - 2; -- the result of the expression will be assigned to a (int)
return  a * 2; -- the result will be 2 and not -1, because 1 is included and not 3 - 2
</pre></div>

    <h3>doはC#のusingのようにIDisposeを呼び出す</h3>
    <div class="code"><pre class="brush:lua">
do (sw = clr.System.IO.StreamReader([[C:\ccc\loaddll.lua]]))
  hm.debuginfo(sw:ReadToEnd());
end
</pre></div>
    <h3>clrの基本 ①</h3>
    <div class="code"><pre class="brush:lua">
local sys = clr.System;

local StringBuilder = sys.Text.StringBuilder
local StringBuilder1 = clr.System.Text.StringBuilder -- same result
</pre></div>

    <h3>clrの基本 ②</h3>
    <div class="code"><pre class="brush:lua">
    local sys = clr.System
    local sb = sys.Text.StringBuilder()
    sb:Append('Hallo '):Append('Welt!')
    local str = sb:ToString()
    </pre></div>
    <h3>clrのGeneric ①</h3>
    <div class="code"><pre class="brush:lua">
local lstObject = clr.System.Collections.Generic.List[clr.System.Object]()
local ListGeneric = clr.System.Collections.Generic.List
local lstString = ListGeneric[clr.System.String]()
local ListStringType = ListGeneric[clr.System.String]
local lstString2 = ListStringType()
</pre></div>
    <h3>clrのGeneric ②</h3>
    <div class="code"><pre class="brush:lua">
local lst = clr.System.Collections.Generic.List[clr.System.Object]()

lst:Add(1)
lst:Add(2)
lst:Add("String")

hm.debuginfo("Enum:")
foreach a in lst do
  hm.debuginfo(a)
end;

hm.debuginfo("Index:")
for i = 0,lst.Count-1,1 do
  hm.debuginfo(i .. ": " .. lst[i])
end

local cnt = lst.Count
</pre></div>

    <h3>clrの配列 ①</h3>
    <div class="code"><pre class="brush:lua">
    local a : int[] = clr.System.Int32[3] -- int is not a identifier
    a[0] = 23
    a[1] = 42
    a[2] = 256
    hm.debuginfo( a[0] + a[1] + a[2] )
    </pre></div>

    <h3>clrの配列 ②</h3>
    <div class="code"><pre class="brush:lua">
    const int typeof System.Int32 -- declare the identifier
    local a : int[] = int[](23, 42, 256)
    hm.debuginfo( a[0] + a[1] + a[2] )
    </pre></div>
    <h3>clrの多次元配列</h3>
    <div class="code"><pre class="brush:lua">
    const int typeof System.Int32 -- declare the identifier
    local a = int[2, 2]
    a[0,0] = 23
    a[1,1] = 42
    hm.debuginfo( a[0,0] + a[1,1] )
    </pre></div>
</ul>