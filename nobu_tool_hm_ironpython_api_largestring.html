%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>長大文字列を秀丸エディタに反映する</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>秀丸マクロでは、「変数の合計のメモリ使用量」が制限されています。<br>
    (デフォルトでは1M)<br>
    このため、長大な文字列をhmPy内で構築した場合に、これを秀丸エディタへと反映するには面倒な手順が必要でした。<br>
    </p>
    <p>しかし、秀丸エディタ v8.30以降では、改善されたため、以下のような工夫をすることで、この制限を回避する手段があります。</p>
    <li>
    <h3>長大文字列の秀丸本体への反映</h3>
    <p>秀丸エディタ v8.30以降では、</p>
    <ul>
        <li><b>一時変数を利用しなければ、何かの関数の結果を、別の関数等の引数へと渡した際、 メモリ制限を受けない</b></li>
    </ul>
    <p>ようになっています。<br>
    この性質を利用して、</p>
    <div class="code"><pre class="brush:python;highlight:[16]">
#PY = loaddll( hidemarudir + @&quot;\hmPY.dll&quot; );

if ( !#PY ) {
    message(&quot;hmPy.dllが導入されていません&quot;);
    endmacro;
}

#_ = dllfuncw(#PY, &quot;DoString&quot;, R&quot;IRONPYTHON(
totalstring = "なんらかの手段によって、長大な文字列を構成"  # 現在のアクティブな(同じプロセスの)全テキストを取得
)IRONPYTHON&quot;
);

// 全て選択し
selectall;
// 秀丸エディタへと挿入する。この際に変数を介することなく、「dllfuncstrw」の返り値をそのまま引数として渡すことが重要。
insert dllfuncstrw( #PY, &quot;GetStrVar&quot;, &quot;totalstring&quot; );

freedll( #PY );
</pre></div>
    <p><b>dllfuncstrwの返り値を一時変数で受け取らない</b>ことが重要です。<br>
    これにより、秀丸に存在する「変数のメモリ制限」という制約を受けなくて済むため、<br>
    hmPyで長大な文字列を生成したものをそのまま秀丸へと反映できます。</p>
    <p>例えば、次のようにしてしまうと、秀丸の「変数のメモリ制限(１つのマクロ内で使える全ての変数の合計量のメモリの制限)」の影響を受けてしまいます。<br>
    <div class="code"><pre class="brush:python;first-line:13 highlight:[16, 17]">
// 全て選択し
selectall;
// $retのように変数として受け取ってしまうと、秀丸マクロ自体が持つ「変数のメモリ制限」にひっかかる可能性があるため、長大な文字列を取り扱えなくなる。
$ret = dllfuncstrw( #PY, &quot;GetStrVar&quot;, &quot;totalstring&quot; );
insert $ret;

freedll( #PY );
</pre></div>
    <li>
    <h3>長大文字列とUnicode</h3>
    <p>文章が長大化すればするほど、cp932(sjis)では取り扱えない文字が混入する可能性が高まります。<br>
    そういった場合は、<a href="?page=nobu_tool_hm_ironpython_utf16">文字コードの指定</a>で対応すると良いでしょう。</p>
</ul>

