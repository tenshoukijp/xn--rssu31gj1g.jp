%(hilight)s
<h2><i class="fa fa-lua fa-fw"></i>秀丸掲示板での捕捉用ページ (20160811)</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <li>
    <h3>ダウンロード</h3>
    <dl>
        <dt>
        <div class="download_file">DOWNLOAD ⇒ <a href="%(file)s">wpfhide.zip</a>ファイル。</div>
        </dt>
        <dd>
        <div class="update_time">└更新日 %(year)04d/%(mon)02d/%(mday)02d</div>
        </dd>
    </dl>
    <ul>
        <li>wpfhide.zipに「wpfhide.dll」と「wpfhide.mac」が同封されています。
        <li>dllの実行には.NET Frramework 4.6と<a href="https://www.microsoft.com/ja-jp/download/details.aspx?id=48145">vs2015 x86 runtime</a>が必要です。
    </ul>
    <ul>
        <li>上記ファイルの.NET FrameworkやVS2015環境が新しすぎて、テスト環境を構築し難いといったことであれば、<br>
        「<a href="./other_soft/hm_kaisetsu/wpfhide_vs2008_net35.zip">wpfhide_vs2008_net35.zip</a>」を利用してください。<br>
        全く同じソースですが、「.NET Frameworkは3.5」「VS2008 x86 runtime」と、<br>
        相当枯れた(むしろ使ってる人逆に少ないｗ）バージョンのものです。<br>
    </ul>
    <li>
    <h3>実行結果</h3>
    <img src="./other_soft/hm_kaisetsu/cnt_hm_20160811_wpf_hide3.png">
    <h3>wpfhide.dllのソースや、wpfhide.dllの作り方</h3>
    <ul class="pointlist">
        <li>
        <h4>ソース</h4>
        <p>wpfhide.cppなどとする。win32用のdllであるが、/clrライブラリを使用した一般的な混成アセンブリdll</p>
        <div class="code"><pre class="brush:cpp">
// wpfhide.h
#include &lt;windows.h&gt;
#include &lt;tchar.h&gt;

using namespace System::Windows;


public ref class MyWindows : System::Windows::Window
{
  public: MyWindows() {}
  public: static MyWindows^ f;
  // TODO: このクラスの、ユーザーのメソッドをここに追加してください。
};

extern &quot;C&quot; __declspec(dllexport) int init(char *handle) {
  MyWindows::f  = gcnew MyWindows();
  MyWindows::f-&gt;ShowDialog();
  return 0;
}

#pragma unmanaged
BOOL WINAPI DllMain(HINSTANCE hinstDll, DWORD dwReason, LPVOID lpReserved)
{
  switch (dwReason) {

  case DLL_PROCESS_ATTACH: // DLLがプロセスのアドレス空間にマッピングされた。
    OutputDebugString(_T(&quot;DLL_PROCESS_ATTACH&quot;));
    break;

  case DLL_THREAD_ATTACH: // スレッドが作成されようとしている。
    break;

  case DLL_THREAD_DETACH: // スレッドが破棄されようとしている。
    break;

  case DLL_PROCESS_DETACH: // DLLのマッピングが解除されようとしている。
    OutputDebugString(_T(&quot;DLL_PROCESS_DETACH&quot;));
    break;

  }

  return TRUE;
}

</pre></div>

        <li>
        <h4>.macの内容</h4>
        <div class="code"><pre class="brush:cpp">
#dll = loaddll( currentmacrodirectory + &quot;\\&quot; + &quot;wpfhide.dll&quot; );

#_ = dllfunc(#dll, &quot;init&quot;, 0);

message(&quot;ここきた&quot;);

freedll(#dll);

message(&quot;デタッチした(つもり)。だがデタッチはされない&quot;);
</pre></div>
        <li>
        <h4>dllのプロジェクトの設定</h4>
        <p>clrが有効</p>
        <img src="./other_soft/hm_kaisetsu/cnt_hm_20160811_wpf_hide1.png"> <br>
        <br>
        <li>
        <h4>dllのマネージドアセンブリ参照</h4>
        <p>今回はWin系ではFormと匹敵する使用頻度となるであろうWPF系にしてみました。</p>
        <img src="./other_soft/hm_kaisetsu/cnt_hm_20160811_wpf_hide2.png">
    </ul>
</ul>