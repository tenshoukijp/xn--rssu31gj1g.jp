%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>「hmPy・IronPython」の例題⑦ 外部プロセスの呼び出し</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>IronPythonの例題のひとつとなります。<br></p>

    <h3>外部プロセスを呼び出し、結果を文字列で受け取る</h3>
    <p>すでに存在する外部のプロセスを呼び出して処理をする、といったシーンは現在もそれなりに存在します。<br>
    特にコンソールコマンドの類はその傾向があることでしょう。</p>

    <div class="code"><pre class="brush:python">
#PY = loaddll( hidemarudir + @&quot;\hmPy.dll&quot; );

#_ = dllfuncw(#PY, &quot;DoString&quot;, R&quot;PY(
import clr

import System
from System.Diagnostics import Process

command = &quot;cmd.exe&quot;
command_args = &quot;/c dir&quot;

p = Process()

#p.StartInfo.FileName = command                    # 一般的なプログラムならこれで良い。実行するコマンドを秀丸からもらう

# 今回の例では、一般のプログラムではなく、(旧)DOS系のコンソールコマンド。「dir.exe」などというファイルがあるわけではなく…
p.StartInfo.FileName = System.Environment.GetEnvironmentVariable(&quot;ComSpec&quot;);

p.StartInfo.CreateNoWindow = False                # コンソールを開かない
p.StartInfo.UseShellExecute = False                # シェル機能を使用しない
p.StartInfo.RedirectStandardOutput  = True         # 標準出力をリダイレクト
p.StartInfo.RedirectStandardInput  = False         # 標準入力をリダイレクトはしない
p.StartInfo.Arguments       = command_args

p.Start()
output = p.StandardOutput.ReadToEnd()              # 標準出力の一気な読み取り
p.WaitForExit()
p.Close()

output.Replace(&quot;\r\r\n&quot;, &quot;\n&quot;)                     # 改行コードの修正。
# 他にもIronPythonの段階で、.NETの正規表現クラス等を利用して、値をパースしていくことも容易でしょう。
# 少なくとも秀丸マクロでやるよりは何倍も簡単でエレガントな記述となるハズです。
hm.debuginfo(output)

hm.Macro.Var[&quot;$output&quot;] = output

hm.Macro.Eval(r&quot;&quot;&quot;
    message $output
&quot;&quot;&quot;
);

)PY&quot;
);

freedll( #PY );
)PY&quot;
);

freedll( #PY );
</pre></div>
    <p><img src="./other_soft/hm_ironpython/cnt_hm_ironpython_15.png"></p>
</ul>