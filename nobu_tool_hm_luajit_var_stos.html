%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>「秀丸マクロ」のスコープと「hmLJ/LuaJIT」のスコープとの値のやり取り</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>LuaJITの例題のひとつとなります。<br>
    </p>

    <h3>スコープ間の値のやりとり</h3>
    <p>hmLJがLuaJITに付け加えている機能とは、まさにここになります。<br>
    「秀丸マクロ」のスコープと「hmLJ/LuaJIT」のスコープとの値のやり取りをみてみましょう。</p>

    <p>Luaの配列はindexが「１」から始まるということに注意しましょう。</p>
    <div class="code"><pre class="brush:python">
#L = loaddll( hidemarudir + &quot;\\&quot; + &quot;hmLJ.dll&quot; );

// テーブル{1,2,3}をbbbに代入
#_ = dllfunc(#L, &quot;DoString&quot;, &quot;bbb = {1,2,3}\n&quot;);

#_ = dllfunc(#L, &quot;SetNumVar&quot;, &quot;var1&quot;, 100);
#num = dllfunc(#L, &quot;GetNumVar&quot;, &quot;var1&quot;);
message(str(#num));

#_ = dllfunc(#L, &quot;DoString&quot;, &quot;bbb[2] = var1\n&quot; );

// bbbの[2]をresult_numという変数に代入
#_ = dllfunc(#L, &quot;DoString&quot;, &quot;result_num = bbb[2]&quot; );

// resultの数値を得る
#result_num = dllfunc(#L, &quot;GetNumVar&quot;, &quot;result_num&quot;);

// 表示
message(str(#result_num));

// LuaJITのスコープにグローバル変数nameとして「武田信玄」という文字列を代入
#_ = dllfunc(#L, &quot;SetStrVar&quot;, &quot;name&quot;, &quot;武田信玄&quot;);

// 今設定した値を秀丸マクロ側に取得
$name = dllfuncstr(#L, &quot;GetStrVar&quot;, &quot;name&quot;);
message($name);

// bbb[1]の値と-200の絶対値を足しこんで、result_numという変数に代入
#_ = dllfunc(#L, &quot;DoString&quot;, &quot;&quot;+
    &quot;result_num = bbb[1] + math.abs(-200)\n&quot;
);

// それを秀丸マクロ側に得る
#result_num = dllfunc(#L, &quot;GetNumVar&quot;, &quot;result_num&quot;);

// 文字列として表示
message(str(#result_num));

freedll(#L);

</pre></div>
    <p><img src="./other_soft/hm_ironpython/cnt_hm_ironpython_10.png"></p>
</ul>