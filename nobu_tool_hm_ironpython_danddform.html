%(hilight)s
<h2><i class="fa fa fa-book fa-fw"></i>ドラッグ＆ドラッグとフォーム</h2>
<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>IronPythonの例の１つとなります。www.ironpython.infoにある例題と同じです。</p>

    <h3>ドラッグアンドドロップ</h3>
    <p>フォームに適当にドラッグ＆ドロップし、最後に秀丸にリストを返すといった例にしてみましょう。</p>
    <p>以下のファイルをdraganddrop.pyとして保存します。</p>
    <div class="code"><pre class="brush:python">
# coding : cp932

import clr
clr.AddReference('System.Windows.Forms')
clr.AddReference('System.Drawing')

from System.Drawing import Point, Size
from System.Windows.Forms import Application, DragDropEffects, DataFormats, Form, ListBox

class DragAndDropForm(Form):
    def __init__(self):

        self._listBox1 = ListBox()
        self._listBox1.AllowDrop = True
        self._listBox1.FormattingEnabled = True
        self._listBox1.ItemHeight = 12
        self._listBox1.Location = Point(12, 19)
        self._listBox1.Size = Size(413, 208)
        self._listBox1.TabIndex = 0
        self._listBox1.DragEnter += self._drag_enter
        self._listBox1.DragDrop += self._drag_drop


        self.AllowDrop = True
        self.ClientSize = Size(440, 250)
        self.Controls.Add(self._listBox1)

        self.Text = 'Drag and Drop Form'


    def _drag_enter(self, sender, e):
        if e.Data.GetDataPresent(DataFormats.FileDrop):
            e.Effect = DragDropEffects.All
        else:
            e.Effect = DragDropEffects.None


    def _drag_drop(self, sender, e):
        data = e.Data.GetData(DataFormats.FileDrop, False)
        for s in data:
            print self._listBox1.Items.Add(s)

listcnt = 0
listref = []
dNd = DragAndDropForm()
try:
    dNd.ShowDialog()
    hm.debuginfo(dNd._listBox1.Items.Count)
    for i in dNd._listBox1.Items:
        listref.append(i)
        hm.debuginfo(i)
    listcnt = dNd._listBox1.Items.Count
except:
    dNd.Close()
finally:
    dNd.Close()
</pre></div>
    <h3>.macからの呼び出し</h3>
    <p>本来は、IronPython内で「hm.Macro.Var[...]で処理した方が楽ですが、<br>
        ここでは秀丸マクロからIronPythonの値を取得する形で記述してみましょう。<br>
        「リストの個数」を得て、Get***ItemOfListで取得していく、というモノです。</p>
    <div class="code"><pre class="brush:python">
#PY = loaddll( hidemarudir + &quot;\\hmPy.dll&quot;);

#_ = dllfuncw( #PY, &quot;DoFile&quot;, currentmacrodirectory + &quot;\\draganddrop.py&quot;);

#listcnt = dllfuncw( #PY, &quot;GetNumVar&quot;, &quot;listcnt&quot; );

##i=0;
while(##i &lt; #listcnt) {
    $$item = dllfuncstrw( #PY, &quot;GetStrItemOfList&quot;, &quot;listref&quot;, ##i );
    message($$item);
    ##i = ##i + 1;
}

freedll( #PY );

</pre></div>
    <p><img src="./other_soft/hm_ironpython/cnt_hm_ironpython_39.png"></p>
</ul>