%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>hmPerlが持つ特別な関数一覧</h2>

<ul class="checklist">
    <li>
    <h3>hmPerl.pm</h3>
    <p>各自が手軽にカスタム可能な形で、hmPerl.pmにて定義されています。</p>
    <p><span class="positive">hmPerl.dllとhmPerl.pmを繋げるものは「$::hm_Edit_***」や「$::hm_Macro_***」などのグローバル変数だけ</span>であり、<br>
    その他はすべて自由に編集可能です。</p>
    <p>又、提供しているhmPerl.pmはルーズに組まれており、<br>
    「hm-&gt;Edit-&gt;TotalText」ではなく、「hm-&gt;TotalText」といった記述でも動作します。</p>
    <li>
    <h3>デバッグ用途関数</h3>
    <p>デバッグ用途として以下の関数を利用し、「秀丸デバッグモニター」などに値や文字列を表示されることが出来ます。</p>
    <ul class="pointlist">
        <li>
        <h4>hm-&gt;debuginfo( 文字列 )</h4>
        <p>対象の文字列を、システムデバッガへと文字列を転送します。<br>
        「秀丸デバッグモニター」などに値や文字列を確認することが可能です。</p>
    </ul>
    <li>
    <h3>編集中エディタに対する関数</h3>
    <p>現在秀丸エディタで開いているテキストに対して、以下の関数を利用することが出来ます。</p>
    <ul class="pointlist">
        <li>
        <h4>テキスト全体</h4>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Edit-&gt;TotalText</h5>
            <p>現在編集中の秀丸エディタのテキスト全体を得る</p>
            <li>
            <h5>hm-&gt;Edit-&gt;TotalText( 文字列 )</h5>
            <p>現在編集中の秀丸エディタのテキスト全体を、引数の文字列にする。</p>
        </ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(
my $totaltext = hm-&gt;TotalText;
hm-&gt;debuginfo($totaltext);

hm-&gt;TotalText(&quot;あいうえお&quot;);
)PERL&quot;);

freedll( #Perl );
</pre></div>
        <li>
        <h4>選択中のテキスト</h4>
        <p>(単純選択のみが対象となります。ボックス選択や複数選択は対象にはなりません)</p>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Edit-&gt;SelectedText</h5>
            <p>現在編集中の秀丸エディタの「選択している」テキストを得る。</p>
            <li>
            <h5>hm-&gt;Edit-&gt;SelectedText( 文字列 )</h5>
            <p>現在編集中の秀丸エディタの「選択している」テキストを、引数の文字列へと置き換える。</p>
        </ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(
# 何かを単純選択していたら、テキストが得られる
my $selectedtext = hm-&gt;SelectedText;
hm-&gt;debuginfo($selectedtext);

hm-&gt;SelectedText(&quot;選択しているテキストをこの文字列に置き換えた&quot;);
)PERL&quot;);

freedll( #Perl );

</pre></div>
        <li>
        <h4>カーソルがある行のテキスト</h4>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Edit-&gt;LineText</h5>
            <p>現在編集中の秀丸エディタの「カーソルがある行」のテキストを得る。</p>
            <li>
            <h5>hm-&gt;Edit-&gt;LineText( 文字列 )</h5>
            <p>現在編集中の秀丸エディタの「カーソルがある行」のテキストを、引数の文字列へと置き換える。<br>
        </ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(
my $linetext = hm-&gt;LineText;
hm-&gt;debuginfo($linetext);

# 行のテキストを入れ替える感じにするなら、最後に「\n」を付けること。
hm-&gt;LineText(&quot;カーソル行のテキストをこれに変更\n&quot;);
)PERL&quot;);

freedll( #Perl );
</pre></div>
        <li>
        <h4>カーソルの位置</h4>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Edit-&gt;CursorPos-&gt;{lineno}</h5>
            <p>現在選択中の秀丸エディタのカーソル位置の行番号を得る。<br>
            秀丸マクロのlinenoと同じ値。</p>
            <li>
            <h5>hm-&gt;Edit-&gt;CursorPos-&gt;{column}</h5>
            <p>現在選択中の秀丸エディタのカーソル位置のカラム値を得る。<br>
            秀丸マクロのcolumnと同じ値。</p>
        </ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(
my $lineno = hm-&gt;Edit-&gt;CursorPos-&gt;{lineno};
my $column = hm-&gt;Edit-&gt;CursorPos-&gt;{column};
hm-&gt;debuginfo( &quot;($lineno, $column)&quot; );
)PERL&quot;);

freedll( #Perl );
</pre></div>
        <li>
        <h4>関数で扱うのがまどろっこしいということであれば…</h4>
        <p>hmPerl.pmを見ればわかるように、値は「$::hm_Edit_TotalText」等に対して行っているわけですから、<br>
        それを直接取り扱っても良いでしょう。(むしろその方が記述が単純です)</p>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(


# テキストを選択中だったら
if ( hm-&gt;Macro-&gt;Var('selecting') ) {
  # 選択範囲の「テキスト」という文字を「トスキテ」に置き換え
  $::hm_Edit_SelectedText =~ s/テキスト/トスキテ/g;

} else {
  # テキスト全体の「テキスト」という文字を「トスキテ」に置き換え
  $::hm_Edit_TotalText =~ s/テキスト/トスキテ/g;
}

)PERL&quot;);

freedll( #Perl );
</pre></div>
    </ul>
    <li>
    <h3>Perlから秀丸マクロへアクセスする関数</h3>
    <p>ActivePerlの機能をフルに生かしつつ、秀丸マクロの機能や各種値もほぼ全て使えるところが、<br>
    hmPerlが優れている所以です。</p>
    <ul>
        <li>秀丸マクロをそのまま実行
        <li>「秀丸マクロの変数」⇔「Perlの変数」を相互にやり取り。
    </ul>
    <p>の２つの手段で秀丸マクロを取り扱うことが出来ます。</p>
    <ul class="pointlist">
        <li>
        <h4>Perlから秀丸マクロを実行</h4>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Macro-&gt;Eval( ヒアドキュメント文字列 )</h5>
            <p>引数の文字列を、「秀丸マクロ」として実行する。</p>
        </ul>
        <li>
        <h4>Perlから秀丸マクロの変数の読み書き</h4>
        <p>変数名は原則的には「シングルクォーテーション」で囲みましょう。<br></p>
        <ul class="arrowlist">
            <li>
            <h5>hm-&gt;Macro-&gt;Var( 変数名 )</h5>
            <p>対象の「秀丸マクロ」としてのシンボル名に対応する値を取得する。</p>
            <li>
            <h5>hm-&gt;Macro-&gt;Var( 変数名 , 新たな値 )</h5>
            <p>対象の「秀丸マクロ」としてのシンボル名に、新たな値を設定する。<br>
            (読み取り専用の値には設定出来ません）</p>
        </ul>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(

# 秀丸マクロの「#aaa」という変数に3を設定。変数名はシングルクォーテーションで囲む
hm-&gt;Macro-&gt;Var('#aaa', 3 );

# 秀丸マクロの「$bbb」という変数に「あいうえお」を設定。変数名はシングルクォーテーションで囲む
hm-&gt;Macro-&gt;Var('$bbb', &quot;あいうえお。&quot; );

# 秀丸マクロとして一連の文字列を実行
hm-&gt;Macro-&gt;Eval(&lt;&lt;'MACRO'
    message($bbb);
    $ccc = $bbb + $bbb;
    message($ccc);
MACRO
);

hm-&gt;debuginfo( hm-&gt;Macro-&gt;Var('$ccc') );
hm-&gt;debuginfo( hm-&gt;Macro-&gt;Var('filename') );

my $hmdate = hm-&gt;Macro-&gt;Var('date');
hm-&gt;debuginfo( $hmdate );

)PERL&quot;);

freedll( #Perl );
        </pre></div>
        <li>
        <h4>関数で扱うのがまどろっこしいということであれば…</h4>
        <p>hmPerl.pmを見ればわかるように、値は「$::hm_Macro_Eval」等に対して行っているわけですから、<br>
        それを直接取り扱った方が、ヒアドキュメント付近の括弧の対応が明瞭になることでしょう。</p>
        <div class="code"><pre class="brush:perl">
#Perl = loaddll( hidemarudir + @&quot;\hmPerl.dll&quot; );

#_ = dllfuncw( #Perl, &quot;DoString&quot;, R&quot;PERL(

$::hm_Macro_Eval =&lt;&lt; 'MACRO';

    $$message = &quot;テスト1\r\nテスト2\r\n&quot;;
    message($$message);

    // アウトプット枠へ出力
    #OP = loaddll(&quot;HmOutputPane.dll&quot;);
    #ret = dllfunc(#OP, &quot;Output&quot;,hidemaruhandle(0), $$message);
    freedll(#OP);

MACRO

# マクロ内で設定した文字列をPerl層で取得。
hm-&gt;debuginfo( hm-&gt;Macro-&gt;Var( '$$message' ) );

)PERL&quot;);

freedll( #Perl );
</pre></div>
    </ul>
</ul>