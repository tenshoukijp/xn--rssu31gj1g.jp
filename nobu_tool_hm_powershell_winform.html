%(hilight)s
<h2><i class="fa fa-book fa-fw"></i>「hmPS・PowerShell」のFormやGUIのコンポーネント</h2>

<ul class="checklist">
    <li>
    <h3>概要</h3>
    <p>C#のクラスと同じような形で実装することとなります。<br>
    <li>
    <h3>フォームの実装</h3>
    <p>以下のようなファイルをwinform.psとして作成してみましょう。<br>
    文字コードはutf-8です。</p>

    <div class="code"><pre class="brush:ps">
[System.Reflection.Assembly]::LoadWithPartialName(&quot;System.Windows.Forms&quot;)

class MyForm {
    [int] $counter;
    [System.Object] $form
    [System.Object] $btn

    SetForm() {
        $this.form = New-Object System.Windows.Forms.Form;
        $this.form.Text = &quot;こんにちわ&quot;;
    }

    [string]$filename2
    SetButton() {
        $this.btn = New-Object System.Windows.Forms.Button;
        $this.btn.Text = &quot;クリック&quot;;
        $this.btn.Left = 16;
        $this.btn.Top = 16;
        $this.btn.Width = 100;
        $this.btn.Height = 40;
        $this.btn.Tag = $this;

        # イベントハンドラも作れる
        $this.btn.Add_Click({
            ($sender, $event) = ($this, $_);
            btn_Click($sender, $event);
        });

        $this.form.Controls.Add($this.btn);
    }

    Show() {
        $this.counter = 0;
        $this.SetForm();
        $this.SetButton();
 
        $this.form.ShowDialog();
    }

}


function btn_Click($sender, $event) {
    $sender.Tag.counter++;

    # デバッグモニター用の関数
    $hm::debuginfo(&quot;ボタンが押されたよ!!&quot;);
    $hm::debuginfo($sender.Tag.counter);

    # 秀丸マクロの「変数」とのやりとりも自由自在
    ($filename2) = $hm::Macro::Var['filename2'];
    $hm::debuginfo($filename2);

    # 秀丸マクロの「変数」とのやりとりも自由自在
    $hm::Macro::Var['$counter'] = [string]$sender.Tag.counter
    # PowerShellの中から秀丸マクロを一連のコマンドとして実行することも出来る。
    # PowerShellには「ヒアドキュメント」が使えるのでちょうどよい
    $hm::Macro::Eval(
@'
        // アウトプット枠へ出力
        #OP = loaddll(&quot;HmOutputPane.dll&quot;);
        #ret = dllfunc(#OP, &quot;Output&quot;,hidemaruhandle(0), $counter);
        freedll(#OP);
'@  );
    }



$f = New-Object MyForm;
$f.Show();
</pre></div>

    <h3>呼び出すマクロ</h3>
    <p>上のファイルを呼び出すマクロを記述し、適当に秀丸に登録して、<br>
    実行してみましょう。<br>
    マクロファイルは、utf-8(BOM付必須)で保存してください。</p>

    <div class="code"><pre class="brush:python">
#PS = loaddll( hidemarudir + &quot;\\&quot; + &quot;hmPS.dll&quot; );

#_ = dllfuncw(#PS, &quot;DoFile&quot;, currentmacrodirectory + &quot;\\winform.ps&quot; );
// 解放
freedll(#PS);
</pre></div>

    <h3>実行イメージ</h3>
    <img src="./other_soft/hm_powershell/cnt_hm_powershell_24.png"> <img src="./other_soft/hm_powershell/cnt_hm_powershell_25.png">
</ul>